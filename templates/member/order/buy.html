{% extends "member/member_base.html" %}
{% block title -%}
    - 创建订单
{% endblock %}
{% block style %}

    body{
    margin:0;
    padding-top: 70px;
    background: #fff;
    }
    .price{
    color: #ff1c1c;
    }
{% endblock %}
{% block content %}

    <div class="container clearfix">
        <div class="panel panel-default">
            <div class="panel-heading">订单创建</div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-12">
                        {% for cart in cart_list %}
                            <div class="media">
                                <div class="media-left">
                                    <a href="#">
                                        <img class="media-object" src="/uploads/{{ cart.goods.thumb }}">
                                    </a>
                                </div>
                                <div class="media-body">
                                    <h4 class="media-heading">
                                        {{ cart.goods.goods_title }}
                                    </h4>

                                    <p>优惠价：<span class="price">{{ cart.goods.price }}</span>元
                                    </p>
                                    <p>购买数量：{{ cart.amount }} 件 <a href="{{ url_for('member.cart_list') }}">返回购物车</a>
                                    </p>

                                </div>
                            </div>
                        {% endfor %}
                        <hr>
                        订单总价:{{ total_price }}元
                        <hr>
                        <form action="{{ url_for("member.create_order") }}" id="order_form" method="post">
                            <div class="form-group">
                                <label for="address">选择地址：</label>
                                <ul id="address_list">
                                    {% for address in addresses %}
                                        <li><label class="radio">
                                            <input type="radio" name="address" id="add_{{ address.id }}"
                                                   value="{{ address.receiver }}：{{ address.mobile }}：{{ address.address }}"/>
                                            {{ address.receiver }}，{{ address.mobile }}，{{ address.address }}
                                        </label></li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="form-group">
                                {{ form.receiver.label }}
                                {{ form.receiver(class="form-control") }}
                            </div>
                            <div class="form-group">
                                {{ form.mobile.label }}
                                {{ form.mobile(class="form-control") }}
                            </div>
                            <div class="form-group">
                                {{ form.address.label }}
                                {{ form.address(class="form-control") }}
                            </div>
                            <div class="form-group">
                                {{ form.payment }}
                                {{ form.csrf_token }}
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3 pull-right">
                <button type="button" class="btn btn-primary alipay-btn" data-payment="alipay">支付宝</button>
                <button type="button" class="btn btn-primary wxpay-btn" data-payment="wxpay">微信支付</button>
            </div>
        </div>
    </div>

    <script>

        $(document).ready(function () {
            $('input[type=radio][name="address"]').change(function () {
                var addr = $('input:radio[name="address"]:checked').val()
                receiver = addr.split("：")[0]
                mobile = addr.split("：")[1]
                address = addr.split("：")[2]
                console.log(receiver, mobile, address)
                $('#receiver').val(receiver)
                $('#mobile').val(mobile)
                $('#address').val(address)
            })
        })
        $('.btn').on('click', function () {
            console.log("click")
            $("[name='payment']").val($(this).data('payment'))
            console.log($("[name='payment']").val())
            $("#order_form").submit()
        })


    </script>
{% endblock %}